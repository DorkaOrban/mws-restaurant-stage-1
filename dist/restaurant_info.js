let restaurant;var map,newMap;const mapboxToken='pk.eyJ1IjoiZG9ya2FvOTQiLCJhIjoiY2pqbGUwN3E5MDRtYjNxcWYycTE2enN0ZCJ9.b8CfdzH5oHBIsUjmvkOf-g';document.addEventListener('DOMContentLoaded',()=>{initMap()}),initMap=()=>{fetchRestaurantFromURL((a,b)=>{a?console.error(a):(self.newMap=L.map('map',{center:[b.latlng.lat,b.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:'mapbox.streets',accessToken:mapboxToken}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})},fetchRestaurantFromURL=a=>{if(self.restaurant)return void a(null,self.restaurant);const b=getParameterByName('id');b?(DBHelper.fetchRestaurantById(b,(c,d)=>{if(self.restaurant=d,!d)return void console.error(c);fillRestaurantHTML(),fillReviewsHTML(self.restaurant.id);(async()=>{await[].forEach.call(document.querySelectorAll('img[data-src]'),function(g){g.setAttribute('src',g.getAttribute('data-src')),g.onload=function(){g.removeAttribute('data-src')}})})(),a(null,d)}),DBHelper.fetchAndCacheReviews()):(error='No restaurant id in URL',a(error,null))},fillRestaurantHTML=(a=self.restaurant)=>{const b=document.getElementById('restaurant-name');b.innerHTML=a.name;const c=document.getElementById('restaurant-address');c.innerHTML=a.address;const d=document.getElementById('restaurant-img');d.className='restaurant-img',d.alt=a.name+' Restaurant Image',d.dataset.src=DBHelper.imageUrlForRestaurant(a);const e=document.getElementById('restaurant-cuisine');e.innerHTML=a.cuisine_type,a.operating_hours&&fillRestaurantHoursHTML()},fillRestaurantHoursHTML=(a=self.restaurant.operating_hours)=>{const b=document.getElementById('restaurant-hours');for(let c in a){const d=document.createElement('tr'),e=document.createElement('td');e.innerHTML=c,e.className='days-of-week',d.appendChild(e);const f=document.createElement('td');f.innerHTML=a[c],d.appendChild(f),b.appendChild(d)}},fillReviewsHTML=(a=self.restaurant.id)=>{const b=document.getElementById('reviews-container'),c=document.createElement('h2');c.innerHTML='Reviews';const d=document.createElement('span');d.className='save-to-favourite',b.appendChild(d);const e=document.createElement('br'),f=document.createElement('button');f.className='send-review-button',f.id='sendReviewBtn',f.innerHTML='Send a review',f.onclick=()=>{document.getElementsByClassName('add-review')[0].style.display='block'};const g=document.getElementById('form-container'),h=document.getElementById('reviewFormContent');g.insertBefore(c,h),g.insertBefore(f,h),g.insertBefore(e,h);var i=DBHelper.fetchReviews(a).then(j=>{const k=document.getElementById('reviews-list');j.forEach(l=>{k.appendChild(createReviewHTML(l))}),b.appendChild(k)});if(!i){const j=document.createElement('p');return j.innerHTML='No reviews yet!',void b.appendChild(j)}},createReviewHTML=a=>{const b=document.createElement('li');if(!navigator.onLine){const h=document.createElement('p');h.classList.add('offline_label'),h.innerHTML='Offline',b.classList.add('reviews_offline'),b.appendChild(h)}const c=document.createElement('p');c.innerHTML=a.name,c.className='reviews-user-name',b.appendChild(c);const d=document.createElement('p'),e=new Date(a.createdAt);d.innerHTML=e.getDate()+'/'+e.getMonth()+'/'+e.getFullYear(),d.className='reviews-user-date',b.appendChild(d);const f=document.createElement('p');f.innerHTML=`Rating: ${a.rating}`,f.className='reviews-user-rating reviews-user-common',b.appendChild(f);const g=document.createElement('p');return g.innerHTML=a.comments,g.className='reviews-user-comments reviews-user-common',b.appendChild(g),b},fillBreadcrumb=(a=self.restaurant)=>{const b=document.getElementById('breadcrumb'),c=document.createElement('li');c.innerHTML=a.name,b.appendChild(c)},getParameterByName=(a,b)=>{b||(b=window.location.href),a=a.replace(/[\[\]]/g,'\\$&');const c=new RegExp(`[?&]${a}(=([^&#]*)|&|#|$)`),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g,' ')):'':null},submitReview=()=>{const a=document.getElementById('reviewerName').value,b=document.getElementById('reviewBody').value,c=document.reviewForm.rating,d=c.value,e=window.location.href.match(/id=(\d+)/);if(e)var f=e[1];const g={restaurant_id:parseInt(f),rating:d,name:a,comments:b.substring(0,300),createdAt:new Date};b&&(DBHelper.addReview(g),createReviewHTML(g),navigator.onLine&&window.location.reload(),console.log('frontendReview.name:',g.name),document.getElementById('reviewFormContent').reset())};