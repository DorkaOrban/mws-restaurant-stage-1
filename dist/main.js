let restaurants,neighborhoods,cuisines;var map,newMap,markers=[];let idbSupported=!1;const mapboxToken='pk.eyJ1IjoiZG9ya2FvOTQiLCJhIjoiY2pqbGUwN3E5MDRtYjNxcWYycTE2enN0ZCJ9.b8CfdzH5oHBIsUjmvkOf-g';document.addEventListener('DOMContentLoaded',()=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.log(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,'undefined'!=typeof b&&null!==b&&b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.log(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,'undefined'!=typeof b&&null!==b&&b.append(d)})},initMap=()=>{self.newMap=L.map('map',{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:'mapbox.streets',accessToken:mapboxToken}).addTo(newMap),updateRestaurants()},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select');if('undefined'!=typeof a&&null!==a){const c=a.selectedIndex,d=b.selectedIndex,e=a[c].value,f=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(e,f,(g,h)=>{g?console.log(g):(resetRestaurants(h),fillRestaurantsHTML())})}},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach(c=>c.setMap(null)),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach(d=>{'undefined'!=typeof d.name&&b.append(createRestaurantHTML(d))});(async()=>{await[].forEach.call(document.querySelectorAll('img[data-src]'),function(e){e.setAttribute('src',e.getAttribute('data-src')),e.onload=function(){e.removeAttribute('data-src')}})})(),addMarkersToMap()},createRestaurantHTML=a=>{const b=document.createElement('li'),c=document.createElement('img');c.className='restaurant-img',c.alt=a.name+' Restaurant Image',c.dataset.src=DBHelper.imageUrlForRestaurant(a),b.append(c);const d=document.createElement('h1');d.className='restaurant-h1-name',d.innerHTML=a.name,b.append(d);const e=document.createElement('span');e.className='save-to-favourite',b.appendChild(e);const f=document.createElement('a');f.className='save-heart-span',f.classList.add('myFavorite'),f.id='saveHeart'+a.id,f.href='javascript:void(0)',f.onclick=function(){const k=!a.is_favorite;DBHelper.updateFavouriteStatus(a.id,k),a.is_favorite=k,changeFavElementClass(f,k)},changeFavElementClass(f,a.is_favorite),f.innerHTML='Save to favourite <i class="fa fa-heart"></i>',e.appendChild(f);const g=document.createElement('br');b.appendChild(g);const h=document.createElement('p');h.innerHTML=a.neighborhood,h.className='neighborhood-p-name',b.append(h);const i=document.createElement('p');i.innerHTML=a.address,i.className='address-p-name',b.append(i);const j=document.createElement('a');return j.innerHTML='View Details',j.setAttribute('aria-label','Read '+a.name+' restaurant details'),j.setAttribute('title','Read '+a.name+' restaurant details'),j.href=DBHelper.urlForRestaurant(a),b.append(j),b},changeFavElementClass=(a,b)=>{b?(console.log('toggle yes update'),a.classList.add('favourite_yes'),a.classList.remove('favourite_no'),a.setAttribute('aria-label','remove as favourite')):(a.classList.remove('favourite_yes'),a.classList.add('favourite_no'),a.setAttribute('aria-label','mark as favourite'))},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const c=DBHelper.mapMarkerForRestaurant(b,self.newMap);'undefined'!=typeof c&&(c.on('click',()=>window.location.href=c.options.url),self.markers.push(c))})};